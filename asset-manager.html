<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Fixed Asset Manager — VOS UI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="vos.css">
    <style>
        body {
            font-family: 'Inter', system-ui, sans-serif;
        }
        /* Custom scrollbar for a better look */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #e2e8f0; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }

        .modal {
            position: fixed;
            inset: 0;
            display: none;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(4px);
            align-items: center;
            justify-content: center;
            z-index: 50;
        }
        .modal.open { display: flex; }
        .drawer {
            position: fixed;
            inset: 0;
            z-index: 40;
            display: none;
        }
        .drawer.open { display: block; }
        .drawer .mask {
            position: absolute;
            inset: 0;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(4px);
        }
        .drawer .panel {
            position: absolute;
            top: 0;
            right: 0;
            height: 100%;
            width: 100%;
            max-width: 450px;
            padding: 1.5rem;
            overflow-y: auto;
        }
        /* Custom prompt modal needs a higher z-index */
        #prompt-modal {
            z-index: 60;
        }
    </style>
</head>
<body>
<script>
    // Auth guard for asset-manager
    (function(){
        try{
            var user = sessionStorage.getItem('vosUser');
            if(!user){ window.location.replace('index.html'); }
        }catch(e){ window.location.replace('index.html'); }
        window.addEventListener('DOMContentLoaded', function(){
            var logoutBtn = document.getElementById('btn-logout');
            if(logoutBtn){
                logoutBtn.addEventListener('click', function(){
                    try{ sessionStorage.removeItem('vosUser'); }catch(_){ }
                    window.location.href = 'index.html';
                });
            }
        });
    })();
</script>

<header class="vos-header">
    <div class="vos-header-inner">
        <div class="vos-brand">VERTEX</div>
        <div class="flex items-center gap-4">
            <button class="vos-btn-primary text-white font-semibold py-2 px-4 rounded-lg" id="btn-new">+ New Asset</button>
            <button class="vos-btn-secondary text-white font-semibold py-2 px-4 rounded-lg" id="btn-logout">Logout</button>
        </div>
    </div>
</header>

<div>
    <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8">
        <h1 class="text-2xl font-semibold leading-6 text-slate-900">
            Asset & Equipments
        </h1>
    </div>
</div>


<main class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mb-6">
        <div class="vos-card p-6">
            <div class="text-sm text-slate-500">Total Assets</div>
            <div class="text-3xl font-bold text-slate-800" id="stat-total">0</div>
        </div>
        <div class="vos-card p-6">
            <div class="text-sm text-slate-500">Total Value</div>
            <div class="text-3xl font-bold text-slate-800" id="stat-total-cost">₱0.00</div>
        </div>
    </div>

    <div class="vos-card p-4 mb-6">
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <input id="search" placeholder="Search by name, employee, etc." class="w-full px-3 py-2 text-slate-900 border rounded-md" />
            <select id="f-cat" class="w-full px-3 py-2 text-slate-900 border rounded-md"></select>
            <select id="f-class" class="w-full px-3 py-2 text-slate-900 border rounded-md"></select>
            <select id="f-dept" class="w-full px-3 py-2 text-slate-900 border rounded-md"></select>
        </div>
    </div>

    <div class="vos-card overflow-x-auto">
        <table class="w-full text-sm text-left vos-table">
            <thead>
            <tr>
                <th class="px-6 py-3">Item Name</th>
                <th class="px-6 py-3">Item Type</th>
                <th class="px-6 py-3">Item Classification</th>
            </tr>
            </thead>
            <tbody id="asset-body">
            </tbody>
        </table>
        <div id="no-results" class="text-center py-12 text-slate-500" style="display: none;">
            <h3 class="font-semibold text-lg text-slate-600">No assets found</h3>
            <p>Try adjusting your search or filter criteria.</p>
        </div>
    </div>
</main>

<div class="modal" id="modal">
    <div class="vos-card w-full max-w-4xl m-4">
        <div class="flex justify-between items-center p-4 border-b">
            <h3 id="modal-title" class="text-lg font-semibold">New Asset</h3>
            <button class="p-2 rounded-full hover:bg-slate-100" onclick="closeModal()">
                <svg class="w-5 h-5 text-slate-600" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/></svg>
            </button>
        </div>
        <form id="asset-form" class="p-4 max-h-[80vh] overflow-y-auto">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="md:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div><label class="label">Item Name</label><input name="itemName" required class="input"></div>
                    <div>
                        <label class="label">Item Type</label>
                        <div class="flex items-center gap-2">
                            <select name="itemType" required class="input"></select>
                            <button type="button" id="btn-new-type" class="vos-btn-secondary p-2 rounded-full" title="Add New Item Type">
                                <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16"><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/></svg>
                            </button>
                        </div>
                    </div>
                    <div>
                        <label class="label">Classification</label>
                        <div class="flex items-center gap-2">
                            <select name="classification" required class="input"></select>
                            <button type="button" id="btn-new-class" class="vos-btn-secondary p-2 rounded-full" title="Add New Classification">
                                <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16"><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/></svg>
                            </button>
                        </div>
                    </div>
                    <div>
                        <label class="label">Department</label>
                        <div class="flex items-center gap-2">
                            <select name="department" required class="input"></select>
                            <button type="button" id="btn-new-dept" class="vos-btn-secondary p-2 rounded-full" title="Add New Department">
                                <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16"><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/></svg>
                            </button>
                        </div>
                    </div>
                    <div><label class="label">Quantity</label><input type="number" name="quantity" required class="input" value="1" min="1"></div>
                    <div><label class="label">Cost per Item (PHP)</label><input type="number" step="0.01" name="costPerItem" required class="input"></div>
                    <div><label class="label">Total Cost</label><input name="totalCost" class="input bg-slate-100" readonly></div>
                    <div><label class="label">Purchase Date</label><input type="date" name="purchaseDate" required class="input"></div>
                    <div><label class="label">Life Span (Years)</label><input type="number" name="lifeSpan" required class="input"></div>
                    <div><label class="label">Condition</label><select name="condition" class="input"><option>New</option><option>Good</option><option>Fair</option><option>For Repair</option></select></div>
                    <div><label class="label">Employee</label><input name="employee" class="input"></div>
                    <div><label class="label">Encoder</label><input name="encoder" class="input"></div>
                </div>
                <div class="md:col-span-1">
                    <label class="label">Image</label>
                    <div class="w-full h-64 border-2 border-dashed rounded-lg flex items-center justify-center bg-slate-50">
                        <img id="image-preview" src="https://placehold.co/400x300/e2e8f0/475569?text=No+Image" class="max-h-full max-w-full object-contain rounded">
                    </div>
                    <input type="file" name="image" id="image-uploader" class="input mt-2" accept="image/*">
                    <input type="hidden" name="imageUrl">
                </div>
            </div>
            <div class="mt-6 flex justify-end gap-3">
                <button type="button" class="vos-btn-secondary py-2 px-4 rounded-lg" onclick="closeModal()">Cancel</button>
                <button type="submit" class="vos-btn-primary text-white font-semibold py-2 px-4 rounded-lg">Save Asset</button>
            </div>
        </form>
    </div>
</div>

<div class="drawer" id="drawer">
    <div class="mask" onclick="closeDrawer()"></div>
    <div class="vos-card panel">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-lg font-semibold">Asset Details</h3>
            <button class="p-2 rounded-full hover:bg-slate-100" onclick="closeDrawer()">
                <svg class="w-5 h-5 text-slate-600" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/></svg>
            </button>
        </div>
        <div id="drawer-body" class="space-y-4"></div>
    </div>
</div>

<div class="modal" id="prompt-modal">
    <div class="vos-card w-full max-w-sm m-4">
        <h3 id="prompt-title" class="text-lg font-semibold p-4 border-b">Add New</h3>
        <div class="p-4">
            <label id="prompt-label" class="label">Name</label>
            <input id="prompt-input" class="input">
            <div id="prompt-error" class="text-sm text-[var(--vos-danger)] mt-1" style="display: none;"></div>
        </div>
        <div class="mt-2 p-4 flex justify-end gap-3 bg-slate-50 rounded-b-xl">
            <button type="button" class="vos-btn-secondary py-2 px-4 rounded-lg" id="prompt-cancel">Cancel</button>
            <button type="button" class="vos-btn-primary text-white font-semibold py-2 px-4 rounded-lg" id="prompt-save">Save</button>
        </div>
    </div>
</div>

<script>
    // --- UTILITIES ---
    const peso = n => new Intl.NumberFormat('en-PH', { style: 'currency', currency: 'PHP' }).format(+n || 0);
    const generateNewAssetId = () => {
        const maxId = assets.reduce((max, asset) => {
            const idNum = parseInt(String(asset.id).split('-').pop(), 10);
            return idNum > max ? idNum : max;
        }, 0);
        const newIdNum = maxId + 1;
        return `FA-${String(newIdNum).padStart(4, '0')}`;
    };

    // --- STATE ---
    let itemTypes = ['IT', 'Furniture', 'Vehicle', 'Machinery', 'Other'];
    let classifications = ['Capitalized', 'Expense', 'Leased'];
    let departments = ['Accounting', 'Human Resources', 'Logistics', 'Manufacturing'];
    let assets = [];
    let editingId = null;

    // --- DOM ELEMENTS ---
    const bodyEl = document.getElementById('asset-body');
    const statTotalEl = document.getElementById('stat-total');
    const statTotalCostEl = document.getElementById('stat-total-cost');
    const modalEl = document.getElementById('modal');
    const formEl = document.getElementById('asset-form');
    const modalTitleEl = document.getElementById('modal-title');
    const drawerEl = document.getElementById('drawer');
    const drawerBodyEl = document.getElementById('drawer-body');
    const noResultsEl = document.getElementById('no-results');
    const searchEl = document.getElementById('search');
    const catFilterEl = document.getElementById('f-cat');
    const deptFilterEl = document.getElementById('f-dept');
    const classFilterEl = document.getElementById('f-class');
    const imagePreviewEl = document.getElementById('image-preview');
    const imageUploaderEl = document.getElementById('image-uploader');
    const promptModalEl = document.getElementById('prompt-modal');
    const promptTitleEl = document.getElementById('prompt-title');
    const promptLabelEl = document.getElementById('prompt-label');
    const promptInputEl = document.getElementById('prompt-input');
    const promptErrorEl = document.getElementById('prompt-error');
    const promptSaveBtn = document.getElementById('prompt-save');
    const promptCancelBtn = document.getElementById('prompt-cancel');
    let currentPromptType = null;

    // --- DATA FETCHING ---
    async function fetchAssets() {
        bodyEl.innerHTML = `<tr><td colspan="3" class="text-center py-12">Loading assets...</td></tr>`;
        try {
            const response = await fetch('/api/items');
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            const data = await response.json();
            assets = data;
        } catch (error) {
            console.error("Could not fetch assets:", error);
            bodyEl.innerHTML = `<tr><td colspan="3" class="text-center py-12 text-red-600">Failed to load assets. ${error.message}</td></tr>`;
        }
    }

    // --- RENDER FUNCTION ---
    function render() {
        const q = searchEl.value.toLowerCase().trim();
        const cat = catFilterEl.value;
        const dept = deptFilterEl.value;
        const classification = classFilterEl.value;

        const filtered = assets.filter(a => {
            const mq = !q || [a.id, a.itemName, a.itemType, a.department, a.employee || '', a.classification || ''].some(x => String(x).toLowerCase().includes(q));
            const mc = cat === 'all' || a.itemType === cat;
            const md = dept === 'all' || a.department === dept;
            const mcl = classification === 'all' || a.classification === classification;
            return mq && mc && md && mcl;
        });

        if (filtered.length === 0) {
            bodyEl.innerHTML = '';
        } else {
            bodyEl.innerHTML = filtered.map(a => `
            <tr class="border-b last:border-0">
              <td class="px-6 py-4 font-medium text-slate-800"><a href="#" class="text-[var(--vos-primary)] hover:underline" onclick="event.preventDefault(); openDrawer('${a.id}')">${a.itemName}</a></td>
              <td class="px-6 py-4">${a.itemType}</td>
              <td class="px-6 py-4">${a.classification}</td>
            </tr>`).join('');
        }

        noResultsEl.style.display = filtered.length === 0 && assets.length > 0 ? 'block' : 'none';
        statTotalEl.textContent = filtered.reduce((sum, a) => sum + (a.quantity || 0), 0);
        statTotalCostEl.textContent = peso(filtered.reduce((s, a) => s + (a.totalCost || 0), 0));
    }

    function populateDynamicFilters() {
        // Item Types
        const allItemTypes = [...new Set([...itemTypes, ...assets.map(a => a.itemType).filter(Boolean)])].sort();
        itemTypes = allItemTypes;
        const typeOptions = allItemTypes.map(t => `<option value="${t}">${t}</option>`).join('');
        catFilterEl.innerHTML = '<option value="all">All Item Types</option>' + typeOptions;
        formEl.elements.itemType.innerHTML = '<option value="">Select...</option>' + typeOptions;

        // Departments
        const allDepartments = [...new Set([...departments, ...assets.map(a => a.department).filter(Boolean)])].sort();
        departments = allDepartments;
        const deptOptions = allDepartments.map(d => `<option value="${d}">${d}</option>`).join('');
        deptFilterEl.innerHTML = '<option value="all">All Departments</option>' + deptOptions;
        formEl.elements.department.innerHTML = '<option value="">Select...</option>' + deptOptions;

        // Classifications
        const allClassifications = [...new Set([...classifications, ...assets.map(a => a.classification).filter(Boolean)])].sort();
        classifications = allClassifications;
        const classOptions = allClassifications.map(c => `<option value="${c}">${c}</option>`).join('');
        classFilterEl.innerHTML = '<option value="all">All Classifications</option>' + classOptions;
        formEl.elements.classification.innerHTML = '<option value="">Select...</option>' + classOptions;
    }

    // --- EVENT HANDLERS & ACTIONS ---
    document.getElementById('btn-new').onclick = () => {
        editingId = null;
        formEl.reset();
        imagePreviewEl.src = 'https://placehold.co/400x300/e2e8f0/475569?text=No+Image';
        formEl.elements.imageUrl.value = '';
        modalTitleEl.textContent = 'New Asset';
        modalEl.classList.add('open');
    };

    function openPrompt(type) {
        currentPromptType = type;
        promptTitleEl.textContent = `Add New ${type}`;
        promptLabelEl.textContent = `${type} Name`;
        promptInputEl.value = '';
        promptErrorEl.style.display = 'none';
        promptModalEl.classList.add('open');
        promptInputEl.focus();
    }

    document.getElementById('btn-new-type').onclick = () => openPrompt('Item Type');
    document.getElementById('btn-new-class').onclick = () => openPrompt('Classification');
    document.getElementById('btn-new-dept').onclick = () => openPrompt('Department');

    promptCancelBtn.onclick = () => {
        if (promptSaveBtn.disabled) return;
        promptModalEl.classList.remove('open');
    };

    async function saveNewItemType(name) {
        const response = await fetch('/api/item-types', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
            body: JSON.stringify({ name: name })
        });
        if (!response.ok) {
            const err = await response.json().catch(() => ({ message: 'Failed to save new type.' }));
            throw new Error(err.message || `HTTP Error: ${response.status}`);
        }
        return await response.json();
    }

    promptSaveBtn.onclick = async () => {
        const value = promptInputEl.value.trim();
        if (!value) {
            promptErrorEl.textContent = 'Name cannot be empty.';
            promptErrorEl.style.display = 'block';
            return;
        }

        promptSaveBtn.disabled = true;
        promptSaveBtn.textContent = 'Saving...';
        promptErrorEl.style.display = 'none';

        try {
            if (currentPromptType === 'Item Type') {
                if (itemTypes.some(item => item.toLowerCase() === value.toLowerCase())) {
                    throw new Error('Item Type already exists.');
                }
                const newItem = await saveNewItemType(value);
                itemTypes.push(newItem.name); // Assume API returns { id, name }
                populateDynamicFilters();
                formEl.elements.itemType.value = newItem.name;
                promptModalEl.classList.remove('open');
            } else if (currentPromptType === 'Department') {
                if (departments.some(item => item.toLowerCase() === value.toLowerCase())) {
                    throw new Error('Department already exists.');
                }
                // NOTE: This remains a client-side only action as requested
                departments.push(value);
                populateDynamicFilters();
                formEl.elements.department.value = value;
                promptModalEl.classList.remove('open');
            } else if (currentPromptType === 'Classification') {
                if (classifications.some(item => item.toLowerCase() === value.toLowerCase())) {
                    throw new Error('Classification already exists.');
                }
                // NOTE: This remains a client-side only action as requested
                classifications.push(value);
                populateDynamicFilters();
                formEl.elements.classification.value = value;
                promptModalEl.classList.remove('open');
            }
        } catch (error) {
            promptErrorEl.textContent = error.message;
            promptErrorEl.style.display = 'block';
        } finally {
            promptSaveBtn.disabled = false;
            promptSaveBtn.textContent = 'Save';
        }
    };


    formEl.onsubmit = e => {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(formEl).entries());
        data.costPerItem = +data.costPerItem;
        data.quantity = +data.quantity;
        data.totalCost = data.costPerItem * data.quantity;
        data.lifeSpan = +data.lifeSpan;

        if (editingId) {
            const index = assets.findIndex(x => x.id == editingId);
            if (index >= 0) {
                data.id = editingId;
                assets[index] = { ...assets[index], ...data };
            }
        } else {
            data.id = generateNewAssetId();
            assets.unshift(data);
        }

        editingId = null;
        closeModal();
        populateDynamicFilters();
        render();
    };

    const updateTotalCost = () => {
        const qty = +formEl.elements.quantity.value || 0;
        const cost = +formEl.elements.costPerItem.value || 0;
        formEl.elements.totalCost.value = peso(qty * cost);
    };
    formEl.elements.quantity.oninput = updateTotalCost;
    formEl.elements.costPerItem.oninput = updateTotalCost;

    imageUploaderEl.onchange = (e) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (event) => {
                const imageUrl = event.target.result;
                imagePreviewEl.src = imageUrl;
                formEl.elements.imageUrl.value = imageUrl;
            };
            reader.readAsDataURL(file);
        }
    };

    window.editAsset = (id) => {
        const asset = assets.find(x => x.id == id);
        if (!asset) return;
        editingId = id;
        closeDrawer();
        modalTitleEl.textContent = 'Edit Asset';
        formEl.reset();
        for (const key in asset) {
            if (formEl.elements[key]) {
                formEl.elements[key].value = asset[key];
            }
        }
        imagePreviewEl.src = asset.imageUrl || 'https://placehold.co/400x300/e2e8f0/475569?text=No+Image';
        updateTotalCost();
        modalEl.classList.add('open');
    }

    window.removeAsset = (id) => {
        if (confirm(`Are you sure you want to delete asset ${id}?`)) {
            assets = assets.filter(x => x.id != id);
            closeDrawer();
            populateDynamicFilters();
            render();
        }
    }

    window.closeModal = () => {
        modalEl.classList.remove('open');
    }

    window.openDrawer = (id) => {
        const a = assets.find(x => x.id == id);
        if (!a) return;

        drawerBodyEl.innerHTML = `
        <div class="vos-card mb-4">
            <img src="${a.imageUrl || 'https://placehold.co/400x300/e2e8f0/475569?text=No+Image'}" class="w-full h-48 object-cover rounded-lg mb-4">
            <div class="text-xl font-bold">${a.itemName}</div>
            <div class="text-sm text-slate-500">${a.id}</div>
        </div>
        <div class="grid grid-cols-2 gap-4">
            ${DetailCard("Item Type", a.itemType)}
            ${DetailCard("Classification", a.classification)}
            ${DetailCard("Department", a.department, true)}
            ${DetailCard("Employee", a.employee, true)}
            ${DetailCard("Purchase Date", a.purchaseDate ? new Date(a.purchaseDate).toLocaleDateString() : 'N/A')}
            ${DetailCard("Quantity", a.quantity)}
            ${DetailCard("Cost per Item", peso(a.costPerItem))}
            ${DetailCard("Total Cost", `<strong class="text-[var(--vos-accent)]">${peso(a.totalCost)}</strong>`)}
            ${DetailCard("Life Span", a.lifeSpan ? `${a.lifeSpan} years` : 'N/A')}
            ${DetailCard("Condition", a.condition)}
            ${DetailCard("Encoder", a.encoder, true)}
        </div>
        <div class="mt-6 flex gap-2">
            <button class='vos-btn-primary text-white font-semibold py-2 px-4 rounded-lg w-full' onclick="editAsset('${a.id}')">Edit</button>
            <button class='vos-btn-danger text-white font-semibold py-2 px-4 rounded-lg w-full' onclick="removeAsset('${a.id}')">Delete</button>
        </div>
      `;
        drawerEl.classList.add('open');
    }
    const DetailCard = (label, value, full = false) => value ? `<div class="vos-card p-3 ${full ? 'col-span-2' : ''}"><div class="text-xs text-slate-500">${label}</div><div class="font-semibold">${value}</div></div>` : '';

    window.closeDrawer = () => {
        drawerEl.classList.remove('open');
    }

    // --- INITIALIZATION ---
    searchEl.oninput = render;
    catFilterEl.onchange = render;
    deptFilterEl.onchange = render;
    classFilterEl.onchange = render;

    document.querySelectorAll('.label').forEach(el => el.classList.add('block', 'text-sm', 'font-medium', 'text-slate-700', 'mb-1'));
    document.querySelectorAll('.input').forEach(el => el.classList.add('w-full', 'px-3', 'py-2', 'text-slate-900', 'border', 'rounded-md'));

    document.addEventListener('DOMContentLoaded', async () => {
        await fetchAssets();
        populateDynamicFilters();
        render();
    });
</script>
</body>
</html>